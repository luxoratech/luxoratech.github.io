<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Luxora Tech — Full Store</title>
  <meta name="description" content="Luxora Tech - Premium gadgets. Login, add to cart, checkout, admin panel (Firebase)." />
  <style>
    :root{--primary:#2874F0;--accent:#ffd700;--muted:#666}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Arial;background:#f4f6f8;color:#111}
    .container{max-width:1200px;margin:0 auto;padding:16px}
    header{background:linear-gradient(90deg,var(--primary),#0b61c3);color:#fff;padding:12px 0}
    .top{display:flex;align-items:center;gap:16px}
    .logo{font-weight:800;font-size:22px;margin-left:8px}
    .search{flex:1}
    .search input{width:100%;padding:10px;border-radius:6px;border:0}
    .nav-actions{display:flex;gap:10px;align-items:center}
    .btn{background:var(--primary);color:#fff;padding:8px 12px;border-radius:6px;text-decoration:none}
    .layout{display:grid;grid-template-columns:240px 1fr;gap:16px;margin-top:16px}
    aside{background:#fff;padding:12px;border-radius:8px}
    main{min-height:60vh}
    .card{background:#fff;padding:12px;border-radius:8px;box-shadow:0 2px 6px rgba(20,20,30,0.04)}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px}
    .product img{width:100%;height:160px;object-fit:cover;border-radius:6px}
    .product h4{margin:8px 0}
    .price{color:green;font-weight:700}
    .small{font-size:13px;color:var(--muted)}
    .cart-list{display:flex;flex-direction:column;gap:8px}
    .cart-item{display:flex;gap:8px;align-items:center}
    .cart-item img{width:60px;height:50px;object-fit:cover;border-radius:6px}
    .admin-section input,.admin-section textarea{width:100%;padding:8px;margin:6px 0;border-radius:6px;border:1px solid #ddd}
    .admin-section label{font-weight:600}
    footer{margin-top:30px;padding:20px;text-align:center;color:var(--muted)}
    @media (max-width:900px){.layout{grid-template-columns:1fr}.search{order:3}}
  </style>
</head>
<body>
  <header>
    <div class="container top">
      <div style="display:flex;align-items:center;gap:12px">
        <div style="width:44px;height:44px;border-radius:8px;background:#fff;color:var(--primary);display:flex;align-items:center;justify-content:center;font-weight:800">LT</div>
        <div class="logo">Luxora Tech</div>
      </div>
      <div class="search"><input id="searchInput" placeholder="Search gadgets, earbuds, lamps..." /></div>
      <div class="nav-actions">
        <div id="userArea" class="small">Not signed in</div>
        <a id="authBtn" class="btn" href="#">Login</a>
        <a id="cartBtn" class="btn" href="#cart">Cart (<span id="cartCount">0</span>)</a>
      </div>
    </div>
  </header>

  <div class="container layout">
    <aside>
      <div class="card">
        <h3>Categories</h3>
        <ul id="categories" style="list-style:none;padding:0;margin:8px 0;line-height:1.9"></ul>
      </div>
      <div class="card" style="margin-top:12px">
        <h3>Your Cart</h3>
        <div id="cartList" class="cart-list small"></div>
        <div style="margin-top:8px"><strong>Total: ₹<span id="cartTotal">0</span></strong></div>
        <div style="margin-top:8px"><button id="checkoutBtn" class="btn">Checkout</button></div>
      </div>
      <div class="card" style="margin-top:12px">
        <h3>Admin</h3>
        <p class="small">Login as admin to add/edit products & view orders.</p>
        <button id="adminLoginBtn" class="btn" style="background:#111">Admin Login</button>
        <div id="adminArea" style="display:none;margin-top:10px">
          <a id="openAdmin" class="btn" href="#admin">Open Admin Panel</a>
        </div>
      </div>
    </aside>

    <main>
      <section class="card">
        <h2>Deals of the Day</h2>
        <div id="products" class="grid" style="margin-top:12px"></div>
      </section>

      <section id="admin" class="card" style="margin-top:12px;display:none">
        <h3>Admin Panel — Add Product</h3>
        <div class="admin-section">
          <label>Title</label>
          <input id="pTitle" />
          <label>Description</label>
          <textarea id="pDesc"></textarea>
          <label>Price (INR)</label>
          <input id="pPrice" type="number" />
          <label>Image URL</label>
          <input id="pImage" placeholder="https://..." />
          <label>Category</label>
          <input id="pCategory" />
          <button id="addProductBtn" class="btn">Add Product</button>
        </div>
        <h3 style="margin-top:18px">Orders</h3>
        <div id="ordersList" style="max-height:300px;overflow:auto"></div>
      </section>

      <section id="cart" class="card" style="margin-top:12px;display:none">
        <h3>Your Cart</h3>
        <div id="cartFullList"></div>
      </section>
    </main>
  </div>

  <footer>
    © 2025 Luxora Tech — Built with Firebase • Real features: login, cart, admin, orders
  </footer>

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBZbG7pqlaZb5W_Z2OpworlvZc3iZc7KV0",
      authDomain: "luxora-tech.firebaseapp.com",
      projectId: "luxora-tech",
      storageBucket: "luxora-tech.firebasestorage.app",
      messagingSenderId: "251807062134",
      appId: "1:251807062134:web:4d490a19843121ba412757",
      measurementId: "G-7E6T3JSJEZ"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let PRODUCTS = [];
    const CART = JSON.parse(localStorage.getItem('cart_luxora')||'[]');
    const $ = id=>document.getElementById(id);

    function renderCart() {
      const list = $('cartList'); list.innerHTML='';
      let total=0;
      CART.forEach((it,idx)=>{ total += it.price*it.qty;
        const el = document.createElement('div'); el.className='cart-item';
        el.innerHTML = `<img src="${it.image}"/><div><strong>${it.title}</strong><div class=small>Qty: ${it.qty}</div></div><div style="margin-left:auto">₹${it.price}</div>`;
        list.appendChild(el);
      });
      $('cartTotal').innerText = total;
      $('cartCount').innerText = CART.reduce((s,i)=>s+i.qty,0);
      localStorage.setItem('cart_luxora', JSON.stringify(CART));
    }

    function addToCart(p){
      const found = CART.find(x=>x.id===p.id);
      if(found) found.qty++;
      else CART.push({id:p.id,title:p.title,price:p.price,image:p.image,qty:1});
      renderCart();
      alert('Added to cart');
    }

    async function loadProducts(){
      try{
        const snap = await db.collection('products').orderBy('createdAt','desc').get();
        PRODUCTS = snap.docs.map(d=>({id:d.id,...d.data()}));
      }catch(e){
        PRODUCTS = [
          {id:'p1',title:'Smart Speaker Pro',price:3499,image:'https://via.placeholder.com/350x220',category:'Audio',desc:'Premium speaker'},
          {id:'p2',title:'Neon Smart Lamp',price:1999,image:'https://via.placeholder.com/350x220',category:'Lighting',desc:'Ambient lamp'},
          {id:'p3',title:'AirPulse Earbuds',price:2299,image:'https://via.placeholder.com/350x220',category:'Audio',desc:'Wireless earbuds'},
          {id:'p4',title:'LED RGB Strip Light',price:899,image:'https://via.placeholder.com/350x220',category:'Lighting',desc:'Color strip'}
        ];
      }
      renderProducts();
      renderCategories();
    }

    function renderProducts(filter){
      const wrap = $('products'); wrap.innerHTML='';
      const list = PRODUCTS.filter(p=> !filter || p.category===filter || p.title.toLowerCase().includes((filter||'').toLowerCase()));
      list.forEach(p=>{
        const el = document.createElement('div'); el.className='product card';
        el.innerHTML = `<img src="${p.image||'https://via.placeholder.com/350x220'}" alt="${p.title}" /><h4>${p.title}</h4><div class='small'>${p.desc||''}</div><div class='price'>₹${p.price}</div><div style='margin-top:8px'><button class='btn' onclick='addToCart(${JSON.stringify(p).replaceAll("'", """)})'>Add to Cart</button> <a class='btn' href='https://wa.me/916204757485?text=I%20want%20${encodeURIComponent(p.title)}' style='background:#25d366'>Buy on WhatsApp</a></div>`;
        wrap.appendChild(el);
      });
    }

    function renderCategories(){
      const cats = Array.from(new Set(PRODUCTS.map(p=>p.category||'Other')));
      const ul = $('categories'); ul.innerHTML='';
      cats.forEach(c=>{ const li=document.createElement('li'); li.innerHTML=`<a href='#' class='small' onclick="renderProducts('${c}')">${c}</a>`; ul.appendChild(li); });
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      document.getElementById('addProductBtn').addEventListener('click', async ()=>{
        const title = document.getElementById('pTitle').value.trim(); if(!title){alert('Add title');return}
        const doc = { title, desc:document.getElementById('pDesc').value, price: Number(document.getElementById('pPrice').value||0), image:document.getElementById('pImage').value||'https://via.placeholder.com/350x220', category:document.getElementById('pCategory').value||'General', createdAt: firebase.firestore.FieldValue.serverTimestamp() };
        try{
          await db.collection('products').add(doc);
          alert('Product added');
          document.getElementById('pTitle').value='';document.getElementById('pDesc').value='';document.getElementById('pPrice').value='';document.getElementById('pImage').value='';document.getElementById('pCategory').value='';
          loadProducts();
        }catch(e){ alert('Failed: Make sure Firebase is configured and Firestore rules allow writes from your account in test mode.'); }
      });
      document.getElementById('checkoutBtn').addEventListener('click', async ()=>{
        if(CART.length===0){alert('Cart empty');return}
        const user = auth.currentUser || {uid:'guest',email:'guest'};
        const order = { userId:user.uid||'guest', email:user.email||'guest', items:CART, total:CART.reduce((s,i)=>s+i.price*i.qty,0), createdAt: firebase.firestore.Timestamp.now() };
        try{ await db.collection('orders').add(order); }catch(e){ console.warn('Could not save order to Firestore — check config'); }
        const summary = CART.map(i=>`${i.title} x${i.qty} - ₹${i.price}`).join('%0A');
        const total = CART.reduce((s,i)=>s+i.price*i.qty,0);
        window.open(`https://wa.me/916204757485?text=Order:%0A${summary}%0A%0ATotal: ₹${total}`,'_blank');
        CART.length=0; renderCart();
        alert('Order placed (WhatsApp) — saved to Firestore if configured.');
      });
      document.getElementById('authBtn').addEventListener('click', ()=>{
        const email = prompt('Email for sign-in / sign-up'); if(!email) return;
        const pass = prompt('Password (min 6 chars)'); if(!pass) return;
        auth.signInWithEmailAndPassword(email,pass).catch(()=>{ auth.createUserWithEmailAndPassword(email,pass).catch(err=>alert('Auth failed: '+err.message)); });
      });
    });

    auth.onAuthStateChanged(user=>{
      if(user){
        $('userArea').innerText = user.email;
        $('authBtn').innerText = 'Logout';
        $('authBtn').onclick = ()=>auth.signOut();
        db.collection('admins').doc(user.uid).get().then(doc=>{ if(doc.exists) { $('adminArea').style.display='block'; $('openAdmin').onclick=()=>{ $('admin').style.display='block'; window.location.hash='admin'; loadOrders(); } }}).catch(()=>{});
      } else {
        $('userArea').innerText = 'Not signed in';
        $('authBtn').innerText = 'Login';
        $('authBtn').onclick = ()=>{ location.reload(); };
        $('adminArea').style.display='none';
      }
    });

    async function loadOrders(){
      try{
        const snap = await db.collection('orders').orderBy('createdAt','desc').get();
        const el = $('ordersList'); el.innerHTML='';
        snap.docs.forEach(d=>{
          const o = d.data();
          const div = document.createElement('div'); div.className='card'; div.style.margin='8px 0';
          div.innerHTML = `<strong>Order ${d.id}</strong><div class=small>Total: ₹${o.total}</div><div class=small>Items: ${ (o.items||[]).map(x=>x.title+' x'+x.qty).join(', ') }</div>`;
          el.appendChild(div);
        });
      }catch(e){ console.warn('Could not load orders — check Firebase.'); }
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      document.getElementById('searchInput').addEventListener('input', e=>{
        const q = e.target.value.trim().toLowerCase();
        if(!q) renderProducts(); else renderProducts(q);
      });
    });

    renderCart();
    loadProducts();
  </script>
</body>
</html>
